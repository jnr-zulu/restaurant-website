<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Menu - Waffle Heaven</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/admin.css">
    <script src="../../js/main.js" defer></script>
    <script src="../../js/admin.js" defer></script>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-container">
                <h2>Waffle Heaven</h2>
                <p>Admin Portal</p>
            </div>
            <div class="staff-info">
                <img src="../../img/admin-avatar.png" alt="Admin Avatar" class="staff-avatar">
                <p id="admin-name">Admin User</p>
            </div>
            <nav class="admin-nav">
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="manage-menu.html" class="active">Manage Menu</a></li>
                    <li><a href="manage-orders.html">Manage Orders</a></li>
                    <li><a href="manage-users.html">Manage Users</a></li>
                    <li><a href="#" class="logout-btn">Logout</a></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="admin-header">
                <h1>Manage Menu</h1>
                <div class="header-actions">
                    <div class="search-container">
                        <input type="text" id="menu-search" placeholder="Search menu items...">
                    </div>
                    <div class="filter-container">
                        <select id="category-filter">
                            <option value="all">All Categories</option>
                            <option value="1">Sweet Waffles</option>
                            <option value="2">Savory Waffles</option>
                            <option value="3">Beverages</option>
                            <option value="4">Combos</option>
                        </select>
                    </div>
                </div>
            </header>

            <div class="content-container">
                <div class="menu-management">
                    <div class="menu-items-list">
                        <h2>Menu Items</h2>
                        <div class="table-container">
                            <table id="menu-items-table" class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Price (R)</th>
                                        <th>Available</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- This will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="add-menu-item">
                        <h2>Add New Item</h2>
                        <form id="add-item-form" class="admin-form">
                            <div class="form-group">
                                <label for="item-name">Item Name</label>
                                <input type="text" id="item-name" name="item-name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select id="category" name="category" required>
                                    <option value="">Select a category</option>
                                    <option value="1">Sweet Waffles</option>
                                    <option value="2">Savory Waffles</option>
                                    <option value="3">Beverages</option>
                                    <option value="4">Combos</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="price">Price (R)</label>
                                <input type="number" id="price" name="price" min="0" step="0.01" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea id="description" name="description" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="image">Image URL</label>
                                <input type="text" id="image" name="image" placeholder="img/menu/item-name.jpg">
                            </div>
                            
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="available" name="available" checked>
                                    Available
                                </label>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn primary-btn">Add Item</button>
                                <button type="reset" class="btn secondary-btn">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="category-management">
                    <h2>Manage Categories</h2>
                    <div class="category-container">
                        <div class="existing-categories">
                            <h3>Existing Categories</h3>
                            <ul id="categories-list">
                                <li>
                                    <span>Sweet Waffles</span>
                                    <div class="category-actions">
                                        <button class="action-btn edit-btn" data-id="1">Edit</button>
                                    </div>
                                </li>
                                <li>
                                    <span>Savory Waffles</span>
                                    <div class="category-actions">
                                        <button class="action-btn edit-btn" data-id="2">Edit</button>
                                    </div>
                                </li>
                                <li>
                                    <span>Beverages</span>
                                    <div class="category-actions">
                                        <button class="action-btn edit-btn" data-id="3">Edit</button>
                                    </div>
                                </li>
                                <li>
                                    <span>Combos</span>
                                    <div class="category-actions">
                                        <button class="action-btn edit-btn" data-id="4">Edit</button>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="add-category">
                            <h3>Add New Category</h3>
                            <form id="add-category-form" class="admin-form">
                                <div class="form-group">
                                    <label for="category-name">Category Name</label>
                                    <input type="text" id="category-name" name="category-name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="category-description">Description (Optional)</label>
                                    <textarea id="category-description" name="category-description" rows="2"></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn primary-btn">Add Category</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Item Modal -->
    <div id="edit-item-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Menu Item</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-item-form" class="admin-form">
                    <input type="hidden" id="edit-item-id" name="item-id">
                    
                    <div class="form-group">
                        <label for="edit-item-name">Item Name</label>
                        <input type="text" id="edit-item-name" name="item-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-category">Category</label>
                        <select id="edit-category" name="category" required>
                            <option value="">Select a category</option>
                            <option value="1">Sweet Waffles</option>
                            <option value="2">Savory Waffles</option>
                            <option value="3">Beverages</option>
                            <option value="4">Combos</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-price">Price (R)</label>
                        <input type="number" id="edit-price" name="price" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-description">Description</label>
                        <textarea id="edit-description" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-image">Image URL</label>
                        <input type="text" id="edit-image" name="image">
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="edit-available" name="available">
                            Available
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn primary-btn">Save Changes</button>
                        <button type="button" class="btn secondary-btn close-modal-btn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="edit-category-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Category</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-category-form" class="admin-form">
                    <input type="hidden" id="edit-category-id" name="category-id">
                    
                    <div class="form-group">
                        <label for="edit-category-name">Category Name</label>
                        <input type="text" id="edit-category-name" name="category-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-category-description">Description</label>
                        <textarea id="edit-category-description" name="category-description" rows="2"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn primary-btn">Save Changes</button>
                        <button type="button" class="btn secondary-btn close-modal-btn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample menu items data for demonstration
            const menuItems = [
                {
                    id: 1,
                    name: "Classic Maple",
                    category_id: 1,
                    category_name: "Sweet Waffles",
                    price: 45.99,
                    description: "Traditional waffle with maple syrup and butter",
                    image_url: "img/menu/classic-maple.jpg",
                    is_available: true
                },
                {
                    id: 2,
                    name: "Chocolate Dream",
                    category_id: 1,
                    category_name: "Sweet Waffles",
                    price: 55.99,
                    description: "Waffle topped with chocolate sauce, chocolate chips, and whipped cream",
                    image_url: "img/menu/chocolate-dream.jpg",
                    is_available: true
                },
                {
                    id: 3,
                    name: "Berry Bliss",
                    category_id: 1,
                    category_name: "Sweet Waffles",
                    price: 60.99,
                    description: "Waffle with mixed berries, berry compote, and vanilla ice cream",
                    image_url: "img/menu/berry-bliss.jpg",
                    is_available: true
                },
                {
                    id: 4,
                    name: "Banana Nutella",
                    category_id: 1,
                    category_name: "Sweet Waffles",
                    price: 58.99,
                    description: "Waffle with sliced bananas, Nutella, and crushed hazelnuts",
                    image_url: "img/menu/banana-nutella.jpg",
                    is_available: true
                },
                {
                    id: 5,
                    name: "Bacon & Egg",
                    category_id: 2,
                    category_name: "Savory Waffles",
                    price: 65.99,
                    description: "Waffle with crispy bacon, fried egg, and maple syrup",
                    image_url: "img/menu/bacon-egg.jpg",
                    is_available: true
                },
                {
                    id: 6,
                    name: "Chicken & Waffles",
                    category_id: 2,
                    category_name: "Savory Waffles",
                    price: 75.99,
                    description: "Golden waffle with crispy fried chicken and honey butter",
                    image_url: "img/menu/chicken-waffles.jpg",
                    is_available: true
                },
                {
                    id: 7,
                    name: "Coffee",
                    category_id: 3,
                    category_name: "Beverages",
                    price: 22.99,
                    description: "Regular or decaf coffee",
                    image_url: "img/menu/coffee.jpg",
                    is_available: false
                },
                {
                    id: 8,
                    name: "Fresh Juice",
                    category_id: 3,
                    category_name: "Beverages",
                    price: 25.99,
                    description: "Orange, apple, or mixed fruit juice",
                    image_url: "img/menu/fresh-juice.jpg",
                    is_available: true
                }
            ];
            
            // Sample categories
            const categories = [
                {
                    id: 1,
                    name: "Sweet Waffles",
                    description: "Delicious sweet waffles with various toppings"
                },
                {
                    id: 2,
                    name: "Savory Waffles",
                    description: "Hearty savory waffles for breakfast or lunch"
                },
                {
                    id: 3,
                    name: "Beverages",
                    description: "Hot and cold drinks to complement your waffles"
                },
                {
                    id: 4,
                    name: "Combos",
                    description: "Special combinations at a discounted price"
                }
            ];

            // Load menu items
            loadMenuItems(menuItems);
            
            // Filter by category
            const categoryFilter = document.getElementById('category-filter');
            if (categoryFilter) {
                categoryFilter.addEventListener('change', function() {
                    const categoryId = this.value;
                    let filteredItems;
                    
                    if (categoryId === 'all') {
                        filteredItems = menuItems;
                    } else {
                        filteredItems = menuItems.filter(item => item.category_id.toString() === categoryId);
                    }
                    
                    loadMenuItems(filteredItems);
                });
            }
            
            // Search menu items
            const menuSearch = document.getElementById('menu-search');
            if (menuSearch) {
                menuSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const filteredItems = menuItems.filter(item => 
                        item.name.toLowerCase().includes(searchTerm) ||
                        item.description.toLowerCase().includes(searchTerm)
                    );
                    
                    loadMenuItems(filteredItems);
                });
            }
            
            // Add item form submission
            const addItemForm = document.getElementById('add-item-form');
            if (addItemForm) {
                addItemForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(this);
                    
                    // In a real app, this would send data to the server
                    // For demo, we'll simulate adding to our array
                    const newItem = {
                        id: menuItems.length + 1,
                        name: formData.get('item-name'),
                        category_id: parseInt(formData.get('category')),
                        category_name: categories.find(c => c.id === parseInt(formData.get('category'))).name,
                        price: parseFloat(formData.get('price')),
                        description: formData.get('description'),
                        image_url: formData.get('image') || `img/menu/${formData.get('item-name').toLowerCase().replace(/\s+/g, '-')}.jpg`,
                        is_available: formData.get('available') === 'on'
                    };
                    
                    menuItems.push(newItem);
                    loadMenuItems(menuItems);
                    
                    alert('Item added successfully');
                    this.reset();
                });
            }
            
            // Add category form submission
            const addCategoryForm = document.getElementById('add-category-form');
            if (addCategoryForm) {
                addCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(this);
                    
                    // In a real app, this would send data to the server
                    // For demo, we'll simulate adding to our array
                    const newCategory = {
                        id: categories.length + 1,
                        name: formData.get('category-name'),
                        description: formData.get('category-description')
                    };
                    
                    categories.push(newCategory);
                    updateCategoriesList();
                    updateCategorySelects();
                    
                    alert('Category added successfully');
                    this.reset();
                });
            }
            
            // Setup modal close buttons
            const closeModalButtons = document.querySelectorAll('.close-modal, .close-modal-btn');
            closeModalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('edit-item-modal').style.display = 'none';
                    document.getElementById('edit-category-modal').style.display = 'none';
                });
            });
            
            // Setup edit item form submission
            const editItemForm = document.getElementById('edit-item-form');
            if (editItemForm) {
                editItemForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(this);
                    const itemId = formData.get('item-id');
                    
                    // Find the item in our array
                    const itemIndex = menuItems.findIndex(item => item.id.toString() === itemId);
                    
                    if (itemIndex !== -1) {
                        // Update item properties
                        menuItems[itemIndex].name = formData.get('item-name');
                        menuItems[itemIndex].category_id = parseInt(formData.get('category'));
                        menuItems[itemIndex].category_name = categories.find(c => c.id === parseInt(formData.get('category'))).name;
                        menuItems[itemIndex].price = parseFloat(formData.get('price'));
                        menuItems[itemIndex].description = formData.get('description');
                        menuItems[itemIndex].image_url = formData.get('image');
                        menuItems[itemIndex].is_available = formData.get('available') === 'on';
                        
                        // Reload table
                        loadMenuItems(menuItems);
                        
                        alert('Item updated successfully');
                        document.getElementById('edit-item-modal').style.display = 'none';
                    }
                });
            }
            
            // Setup category edit buttons
            const categoryEditButtons = document.querySelectorAll('#categories-list .edit-btn');
            categoryEditButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-id');
                    editCategory(categoryId, categories);
                });
            });
            
            // Setup edit category form submission
            const editCategoryForm = document.getElementById('edit-category-form');
            if (editCategoryForm) {
                editCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(this);
                    const categoryId = formData.get('category-id');
                    
                    // Find the category in our array
                    const categoryIndex = categories.findIndex(category => category.id.toString() === categoryId);
                    
                    if (categoryIndex !== -1) {
                        // Update category properties
                        categories[categoryIndex].name = formData.get('category-name');
                        categories[categoryIndex].description = formData.get('category-description');
                        
                        // Update any menu items that use this category
                        menuItems.forEach(item => {
                            if (item.category_id.toString() === categoryId) {
                                item.category_name = categories[categoryIndex].name;
                            }
                        });
                        
                        // Update UI
                        updateCategoriesList();
                        updateCategorySelects();
                        loadMenuItems(menuItems);
                        
                        alert('Category updated successfully');
                        document.getElementById('edit-category-modal').style.display = 'none';
                    }
                });
            }
            
            function updateCategoriesList() {
                const categoriesList = document.getElementById('categories-list');
                if (categoriesList) {
                    categoriesList.innerHTML = '';
                    
                    categories.forEach(category => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>${category.name}</span>
                            <div class="category-actions">
                                <button class="action-btn edit-btn" data-id="${category.id}">Edit</button>
                            </div>
                        `;
                        
                        categoriesList.appendChild(li);
                    });
                    
                    // Re-attach event listeners
                    const editButtons = categoriesList.querySelectorAll('.edit-btn');
                    editButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const categoryId = this.getAttribute('data-id');
                            editCategory(categoryId, categories);
                        });
                    });
                }
            }
            
            function updateCategorySelects() {
                const categorySelects = document.querySelectorAll('#category, #edit-category, #category-filter');
                
                categorySelects.forEach(select => {
                    // Keep the first option (placeholder) if it exists
                    const firstOption = select.options[0];
                    select.innerHTML = '';
                    
                    if (firstOption && firstOption.value === '') {
                        select.appendChild(firstOption);
                    }
                    
                    // Add "All categories" option for filter
                    if (select.id === 'category-filter') {
                        const allOption = document.createElement('option');
                        allOption.value = 'all';
                        allOption.textContent = 'All Categories';
                        select.appendChild(allOption);
                    }
                    
                    // Add category options
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        select.appendChild(option);
                    });
                });
            }
        });

        function loadMenuItems(items) {
            const tableBody = document.querySelector('#menu-items-table tbody');
            
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (items.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="empty-table">No menu items found</td></tr>';
                return;
            }
            
            items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.category_name}</td>
                    <td>${item.price.toFixed(2)}</td>
                    <td>${item.is_available ? 'Yes' : 'No'}</td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${item.id}">Edit</button>
                        <button class="action-btn delete-btn" data-id="${item.id}">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Setup edit buttons
            const editButtons = document.querySelectorAll('#menu-items-table .edit-btn');
            editButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    editMenuItem(itemId, items);
                });
            });
            
            // Setup delete buttons
            const deleteButtons = document.querySelectorAll('#menu-items-table .delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    deleteMenuItem(itemId, items);
                });
            });
        }

        function editMenuItem(itemId, items) {
            // Find item to edit
            const item = items.find(item => item.id.toString() === itemId);
            
            if (!item) return;
            
            // Populate edit form
            document.getElementById('edit-item-id').value = item.id;
            document.getElementById('edit-item-name').value = item.name;
            document.getElementById('edit-category').value = item.category_id;
            document.getElementById('edit-price').value = item.price;
            document.getElementById('edit-description').value = item.description || '';
            document.getElementById('edit-image').value = item.image_url || '';
            document.getElementById('edit-available').checked = item.is_available;
            
            // Show modal
            document.getElementById('edit-item-modal').style.display = 'block';
        }

        function deleteMenuItem(itemId, items) {
            // Confirm deletion
            if (confirm('Are you sure you want to delete this menu item?')) {
                // In a real app, this would send a delete request to the server
                // For demo, we'll remove from our array
                const itemIndex = items.findIndex(item => item.id.toString() === itemId);
                
                if (itemIndex !== -1) {
                    items.splice(itemIndex, 1);
                    loadMenuItems(items);
                    alert('Item deleted successfully');
                }
            }
        }

        function editCategory(categoryId, categories) {
            // Find category to edit
            const category = categories.find(category => category.id.toString() === categoryId);
            
            if (!category) return;
            
            // Populate edit form
            document.getElementById('edit-category-id').value = category.id;
            document.getElementById('edit-category-name').value = category.name;
            document.getElementById('edit-category-description').value = category.description || '';
            
            // Show modal
            document.getElementById('edit-category-modal').style.display = 'block';
        }
    </script>
</body>
</html>